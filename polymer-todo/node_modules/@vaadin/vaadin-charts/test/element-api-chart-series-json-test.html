<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-chart tests</title>
  <script src="../../../wct-browser-legacy/browser.js"></script>
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
  <script type="module" src="../vaadin-chart.js"></script>
</head>

<body>

  <dom-module id="chart-series-with-json-api">
    <template>
      <vaadin-chart id="mychart">
          <vaadin-chart-series values="[10, 20, 30, 40, 50]" id="series"></vaadin-chart-series>
        </template>
    </template>

    <script type="module">
import '../vaadin-chart.js';
import { PolymerElement } from '@polymer/polymer/polymer-element.js';
customElements.define('chart-series-with-json-api', class extends PolymerElement {
  static get is() {
    return 'chart-series-with-json-api';
  }

  connectedCallback() {
    super.connectedCallback();
    this.$.mychart.update({
      series: [{
        name: 'series-name'
      }]
    });
  }
});
</script>
  </dom-module>
  <chart-series-with-json-api></chart-series-with-json-api>

  <script type="module">
import '../vaadin-chart.js';
import { afterNextRender } from '@polymer/polymer/lib/utils/render-status.js';
describe('High-level Charts Series API with JSON API', function() {
  let chart;
  let element;

  before(function(done) {
    customElements.whenDefined('chart-series-with-json-api').then(() => {
      element = document.querySelector('chart-series-with-json-api');
      chart = element.$.mychart;
      done();
    });
  });

  it('should have 1 series', function(done) {
    afterNextRender(chart.$.chart, () => {
      expect(chart.configuration.series.length).to.be.equal(1);
      done();
    });
  });

  it('should have 1 series with merged options', function(done) {
    afterNextRender(chart.$.chart, () => {
      const series = chart.configuration.series[0];
      const values = series.data.map(({y}) => y);

      expect(series.name).to.be.equal('series-name');
      expect(values).to.deep.equal([10, 20, 30, 40, 50]);
      done();
    });
  });

});
</script>
</body>
